#ifdef MAX7219_H
#ifndef MAX7219_H

#define MAX7219_H


// === Pinos do MAX7219 ===
#define MAX7219_DIN   GPIO_NUM_12
#define MAX7219_CLK   GPIO_NUM_11
#define MAX7219_CS    GPIO_NUM_10

static spi_device_handle_t  SpiDeviceHandle;
// Table 2. Register Address Map do MAX7219
enum {
  REG_NOOP        = 0x00,
  REG_DIGIT0      = 0x01,
  REG_DIGIT1      = 0x02,
  REG_DIGIT2      = 0x03,
  REG_DIGIT3      = 0x04,
  REG_DIGIT4      = 0x05,
  REG_DIGIT5      = 0x06,
  REG_DIGIT6      = 0x07,
  REG_DIGIT7      = 0x08,
  REG_DECODE_MODE = 0x09,
  REG_INTENSITY   = 0x0A,
  REG_SCAN_LIMIT  = 0x0B,
  REG_SHUTDOWN    = 0x0C,
  REG_DISPLAYTEST = 0x0F,
};

static const uint8_t DIGITS_8x8[10][8] = {
    // 0
    {0x3C, 0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x3C},
    // 1
    {0x08, 0x0C, 0x0A, 0x08, 0x08, 0x08, 0x08, 0x3E},
    // 2
    {0x3C, 0x42, 0x40, 0x30, 0x0C, 0x02, 0x02, 0x7E},
    // 3
    {0x3C, 0x42, 0x40, 0x38, 0x40, 0x40, 0x42, 0x3C},
    // 4
    {0x30, 0x28, 0x24, 0x22, 0x7E, 0x20, 0x20, 0x70},
    // 5
    {0x7E, 0x02, 0x02, 0x3E, 0x40, 0x40, 0x42, 0x3C},
    // 6
    {0x38, 0x04, 0x02, 0x3E, 0x42, 0x42, 0x42, 0x3C},
    // 7
    {0x7E, 0x42, 0x20, 0x10, 0x10, 0x08, 0x08, 0x08},
    // 8
    {0x3C, 0x42, 0x42, 0x3C, 0x42, 0x42, 0x42, 0x3C},
    // 9
    {0x3C, 0x42, 0x42, 0x42, 0x7C, 0x40, 0x20, 0x1C}
};

static void max7219_spi_init(void);
static inline esp_err_t max7219_write(uint8_t reg, uint8_t val);
static void max7219_init_chip(void);
static inline void set_line(uint8_t line_idx, bool on);
void draw_digit(uint8_t d);

#endif /*MAX7219_H*/